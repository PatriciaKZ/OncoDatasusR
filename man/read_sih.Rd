% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/read_sih.r
\name{read_sih}
\alias{read_sih}
\title{Read and Process SIH Records}
\usage{
read_sih(
  dir = NULL,
  filename,
  min_age = 0,
  max_age = Inf,
  proc_code = NA,
  select_variables = NA,
  first_year = 2008,
  last_year = NA,
  run_diagnostics = TRUE,
  silent = FALSE,
  export_procedure_table = FALSE,
  procedures_filename = NA,
  file_code = NA,
  group_icd = FALSE,
  icd_group_file_path = NULL
)
}
\arguments{
\item{dir}{Character. Path to the directory containing the SIH data file. If NULL, the function will search for the 'datasus_files' folder in the current working directory.}

\item{filename}{Character. Name of the file containing the SIH data.}

\item{min_age}{Numeric. Minimum age of patients during hospitalization.}

\item{max_age}{Numeric. Maximum age of patients during hospitalization.}

\item{proc_code}{Character. Two-digit procedure code to filter records. Default is NA (no filter applied).}

\item{select_variables}{Character. (Optional) Additional variables to include in the resulting table. Default is NA.}

\item{first_year}{Integer. Earliest year of hospitalizations to retain in the database.}

\item{last_year}{Integer. Most recent year of hospitalizations to retain in the database. Default is NA (no upper limit).}

\item{run_diagnostics}{Logical. If TRUE, performs diagnostics and attaches data quality analysis to the output. Default is TRUE.}

\item{silent}{Logical. If TRUE, suppresses console messages about processing steps. Default is FALSE.}

\item{export_procedure_table}{Logical. If TRUE, saves a .csv file containing a frequency table of procedures present in the database. Default is FALSE.}

\item{procedures_filename}{Character (Optional). Name of the file to save the frequency table of procedures. Default is NA.}

\item{file_code}{Character (Optional). String used in naming the output file. Default is NA.}

\item{group_icd}{Logical. If TRUE, groups procedures by ICD using the \code{icd_group_file_path}. Default is FALSE.}

\item{icd_group_file_path}{Character. Path and name of the file with ICD group mappings. The file must contain columns 'icd' and 'icd_group'. Default is NULL.}
}
\value{
\itemize{
\item If \code{run_diagnostics} is TRUE, returns a list with the following elements:
\itemize{
\item \code{SIH}: A data frame with the filtered SIH data.
\item \code{diag_list}: A list containing diagnostic summaries:
\itemize{
\item \code{row_n}: Number of rows before and after filters.
\item \code{ICD_base_table}: Table summarizing ICD counts.
\item \code{admission_year_table}: Count of records by year of admission.
\item \code{procedure_table}: Frequency table of procedures with descriptions.
\item \code{error_table_all}: Table summarizing data quality errors.
}
}
\item If \code{run_diagnostics} is FALSE, returns only the filtered SIH data as a data frame.
}
}
\description{
This function reads a file containing data from the Hospital Information System (SIH),
filtering records based on patient age, procedure code, and specified year range.
It optionally performs diagnostics of data quality and exports a frequency table
of procedures, including their descriptions.
}
\details{
The function processes SIH data by filtering records based on age, procedure codes, and year of hospitalization. It generates diagnostic tables describing data quality, such as missing values, formatting errors, and inconsistencies in date fields. If \code{group_icd} is TRUE, the function expects an ICD group mapping file, which is used to group procedures in the frequency table output.

The \code{first_year} and \code{last_year} parameters define the range of years for filtering records by admission year. The \code{proc_code} parameter can be used to filter specific procedure types. If \code{export_procedure_table} is TRUE, a procedure frequency table is saved to the specified directory.
}
\examples{
\dontrun{
# Read and process SIH data with diagnostics and procedure table export
result <- read_sih(
  dir = 'path/to/data',
  filename = 'sih_data.csv',
  min_age = 0,
  max_age = 100,
  proc_code = '02',
  select_variables = c('extra_var1', 'extra_var2'),
  first_year = 2008,
  last_year = 2020,
  run_diagnostics = TRUE,
  silent = FALSE,
  export_procedure_table = TRUE,
  file_code = 'SIH'
)
head(result$SIH)
head(result$diag_list)
}
}
